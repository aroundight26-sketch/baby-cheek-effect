<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ほっぺぷるん</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.4/pixi.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: auto;
      touch-action: auto;
    }
    #canvas-wrapper {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
      position: static;
      touch-action: auto;
    }
  </style>
</head>
<body>
  <div id="canvas-wrapper"></div>
  <script>
    const wrapper = document.getElementById('canvas-wrapper');
    const app = new PIXI.Application({
      width: window.innerWidth,
      height: window.innerHeight,
      backgroundAlpha: 0
    });
    wrapper.appendChild(app.view);

    const background = PIXI.Sprite.from('baby.jpg');
    background.anchor.set(0.5);
    app.stage.addChild(background);

    const cheekLeftContainer = new PIXI.Container();
    const cheekRightContainer = new PIXI.Container();
    app.stage.addChild(cheekLeftContainer);
    app.stage.addChild(cheekRightContainer);

    const cheekLeft = PIXI.Sprite.from('cheek-left.png');
    cheekLeft.anchor.set(0.5);
    cheekLeft.interactive = true;
    cheekLeft.buttonMode = true;
    cheekLeft.hitArea = new PIXI.Circle(45, -80, 60);
    cheekLeftContainer.addChild(cheekLeft);

    const cheekRight = PIXI.Sprite.from('cheek-right.png');
    cheekRight.anchor.set(0.5);
    cheekRight.interactive = true;
    cheekRight.buttonMode = true;
    cheekRight.hitArea = new PIXI.Circle(250, -70, 30);
    cheekRightContainer.addChild(cheekRight);

    function resizeAll() {
      app.renderer.resize(window.innerWidth, window.innerHeight);

      const scaleX = app.renderer.width / background.texture.width;
      const scaleY = app.renderer.height / background.texture.height;
      const scale = Math.min(scaleX, scaleY);

      background.scale.set(scale);
      background.x = app.renderer.width / 2;
      background.y = app.renderer.height / 2;

      cheekLeftContainer.scale.set(scale);
      cheekRightContainer.scale.set(scale);
      cheekLeftContainer.x = app.renderer.width / 2;
      cheekLeftContainer.y = app.renderer.height / 2;
      cheekRightContainer.x = app.renderer.width / 2;
      cheekRightContainer.y = app.renderer.height / 2;
    }

    function animateCheek(sprite, scaleX, scaleY, duration = 1600) {
      const original = { x: sprite.scale.x, y: sprite.scale.y };
      const start = performance.now();

      function tick(now) {
        const elapsed = now - start;
        const progress = elapsed / duration;
        const damping = Math.exp(-4 * progress);
        const oscillation = Math.sin(progress * Math.PI * 6);
        const scale = 1 + (scaleX - 1) * damping * oscillation;
        sprite.scale.set(scale, 2 - scale);
        if (progress < 1) {
          requestAnimationFrame(tick);
        } else {
          sprite.scale.set(original.x, original.y);
        }
      }

      requestAnimationFrame(tick);
    }

    cheekLeft.on('pointerdown', () => animateCheek(cheekLeft, 1.1, 0.7));
    cheekRight.on('pointerdown', () => animateCheek(cheekRight, 1.02, 0.9));

    background.texture.baseTexture.once('loaded', resizeAll);
    window.addEventListener('resize', resizeAll);
  </script>
</body>
</html>
